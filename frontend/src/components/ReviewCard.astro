---
import { formatDate } from '../lib/api';

interface Props {
  title: string;
  slug: string;
  excerpt: string;
  rating: number;
  category: string;
  categoryLabel?: string;
  image: string;
  author: string;
  publishedAt: string;
  genre?: string;
  featured?: boolean;
}

const {
  title,
  slug,
  excerpt,
  rating,
  category,
  categoryLabel = '',
  image,
  author,
  publishedAt,
  genre = '',
  featured = false,
} = Astro.props;

const categoryColors: Record<string, string> = {
  peliculas: 'bg-blue-500/10 text-blue-600 dark:text-blue-400',
  series: 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-400',
  videojuegos: 'bg-orange-500/10 text-orange-600 dark:text-orange-400',
};

const ratingColor =
  rating >= 9
    ? 'bg-green-500 text-white'
    : rating >= 7
      ? 'bg-primary text-primary-foreground'
      : rating >= 5
        ? 'bg-yellow-500 text-white'
        : 'bg-red-500 text-white';
---

<article class={`card group ${featured ? 'md:col-span-2' : ''}`}>
  <a href={`/reviews/${slug}/`} class="block" aria-label={`Leer reseña de ${title}`}>
    <div class={`relative overflow-hidden ${featured ? 'aspect-[21/9]' : 'aspect-video'}`}>
      <img
        src={image}
        alt={`Imagen de portada de la reseña de ${title}`}
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading="lazy"
        decoding="async"
      />
      <!-- Rating badge -->
      <div class={`absolute top-3 right-3 ${ratingColor} rounded-lg px-2.5 py-1 font-sans font-bold text-sm`}>
        {rating.toFixed(1)}
      </div>
      <!-- Category badge -->
      <div class={`absolute top-3 left-3 badge ${categoryColors[category] || 'bg-secondary text-secondary-foreground'}`}>
        {categoryLabel}
      </div>
    </div>

    <div class="p-5">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-xs text-muted-foreground font-sans">{genre}</span>
        <span class="text-muted-foreground">|</span>
        <time class="text-xs text-muted-foreground font-sans" datetime={publishedAt}>
          {formatDate(publishedAt)}
        </time>
      </div>

      <h3 class="font-serif text-lg font-bold text-card-foreground mb-2 group-hover:text-primary transition-colors text-balance">
        {title}
      </h3>

      <p class="text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-3">
        {excerpt}
      </p>

      <div class="flex items-center justify-between">
        <span class="text-xs text-muted-foreground font-sans">Por {author}</span>
        <span class="text-xs font-medium text-primary opacity-0 group-hover:opacity-100 transition-opacity font-sans">
          Leer reseña &rarr;
        </span>
      </div>
    </div>
  </a>
</article>
